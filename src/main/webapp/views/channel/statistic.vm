<style>
.nav-tabs li a{padding-left:15px}
</style>
<div class="row margin-bottom-20">
	<div class="col-xs-12">
		<h1>$!channel.chnlName</h1>
		<br>
		<ul id="myTab" class="nav nav-tabs">
			<li class="active"><a href="${rc.contextPath}/channel/overall">交易统计信息</a></li>
		    <li><a href="${rc.contextPath}/channel/channelDetail">基本信息</a></li>
		</ul>
	</div>
</div>
<div class="row">
	<div class="col-xs-6">
		<div class="panel panel-primary">
		    <div class="panel-heading">
		    	<div class="row">
			        <div class="col-xs-12 text-right">
		                <div class="huge">$!channel.restAt<span style="font-size:14px;margin-left:7px">元</span></div>
		                <div>剩余额度</div>
			        </div>
		        </div>
		    </div>
		</div>
	</div>
	<div class="col-xs-6">
		<div class="panel panel-yellow" onclick="window.location.href='${rc.contextPath}/chnlUser/userList'" style="cursor:pointer">
		    <div class="panel-heading">
		    	<div class="row">
		    		<div class="col-xs-3">
		    			<i class="icon-group icon-4x"></i>
		    		</div >
			        <div class="col-xs-9 text-right">
		                <div class="huge">$!chnlUserCount</div>
		                <div>用户数</div>
			        </div>
		        </div>
		    </div>
		</div>
	</div>
	<div class="col-xs-6">
		<div class="panel panel-default">
		    <div class="panel-heading">
		    	<div class="row">
			        <div class="col-xs-12 text-right">
		                <div class="huge">$!channel.dayAtUsed
						<span style="font-size:14px;margin-left:7px">元/
							#if($!channel.dayAtLimit&&""!=$!channel.dayAtLimit)$!channel.dayAtLimit 元 #else 无上限 #end
						</span>
						</div>
		                <div>今日已用额度/每日上限</div>
			        </div>
		        </div>
		    </div>
		</div>
	</div>
	<div class="col-xs-6">
		<div class="panel panel-purple">
		    <div class="panel-heading">
		    	<div class="row">
			        <div class="col-xs-12 text-right">
		                <div class="huge">
			                $!channel.dayTransUsed
							<span style="font-size:14px;margin-left:7px">笔/
								#if($!channel.dayTransLimit&&""!=$!channel.dayTransLimit)$!channel.dayTransLimit 笔 #else 无上限 #end
							</span>
						</div>
		                <div>今日已用笔数/每日上限</div>
			        </div>
		        </div>
		    </div>
		</div>
	</div>
</div>
<div class="row margin-bottom-20">
	<div class="col-xs-12">
		<form class="form-horizontal" action="${rc.contextPath}/channel/overall">
			<div class="form-group" style="margin:0;padding:5px;background-color:#BAD2E6">
				<div class="col-xs-2" style="display:inline-block;"></div>
				<label class="col-xs-1 control-label">开始时间</label>
				<div class="col-xs-2">
					<input class="form-control tmSelect" type="text" id="startTime" name="startTime" value="$!startTime" readonly>
				</div>
				<label class="col-xs-1 control-label">结束时间</label>
				<div class="col-xs-2">
					<input class="form-control tmSelect" type="text" id="endTime" name="endTime" value="$!endTime" readonly>
				</div>
				<div class="col-xs-2">
					<button class="btn btn-primary" onclick="return checkDate()">查询</button>
				</div>
				<div class="col-xs-2" style="display:inline-block"></div>
			</div>
		</form>
	</div>
</div>

<div class="row margin-bottom-20">
	<div class="col-xs-12">
		<div class="panel panel-green">
			<div class="panel-heading">
				<i class="icon-bar-chart"></i>  每日交易量
			</div>
			<div class="panel-body">
				<div class="col-xs-4">时间：$!startTime 至 $!endTime</div>
				<div class="col-xs-4"><span class="statistic-span" style="background-color:#FF6666"></span>交易金额: <span id="totalAt"></span>元</div>
				<div class="col-xs-4"><span class="statistic-span" style="background-color:#0099CC"></span>交易笔数: <span id="totalTrans"></span>笔</div>
				<div class="col-xs-12" style="width:100%;margin:20px auto;">
					#if("$!statResultList"=="[]")
					<h4>未查询到数据，请重新选择日期</h4>
					#else
					<canvas id="myChartDayAt" height="80"></canvas>
					#end
				</div>
			</div>
		</div>
	</div>
</div>

<div class="row margin-bottom-20">
	<div class="col-xs-8">
		<div class="panel panel-primary">
			<div class="panel-heading">
				<i class="icon-tasks"></i>  认证类型认证占比统计
			</div>
			<div class="panel-body">
				<div class="col-xs-7">
					时间：$!startTime 至 $!endTime
					<canvas id="myBarMode" height="450" width="600"></canvas>
				</div>
				<div class="col-xs-5" style="padding:0">
					<table class="table table-hover" style="margin:0">
						<thead>
							<th>认证类型名称</th>
							<th><span class="statistic-span" style="background-color:#FF6666"></span><span>金额(元)</span></th>
							<th><span class="statistic-span" style="background-color:#0099CC"></span>笔数(笔)</th>
						</thead>
						<tbody>
							<tr><td>认证类型1</td><td id="mode1At">#if($!transChnlStatTbl.mode1At)$!transChnlStatTbl.mode1At #else 0 #end</td><td id="mode1Trans">#if($!transChnlStatTbl.mode1Trans)$!transChnlStatTbl.mode1Trans #else 0 #end</td></tr>
							<tr><td>认证类型2</td><td id="mode2At">#if($!transChnlStatTbl.mode2At)$!transChnlStatTbl.mode2At #else 0 #end</td><td id="mode2Trans">#if($!transChnlStatTbl.mode2Trans)$!transChnlStatTbl.mode2Trans #else 0 #end</td></tr>
							<tr><td>认证类型3</td><td id="mode3At">#if($!transChnlStatTbl.mode3At)$!transChnlStatTbl.mode3At #else 0 #end</td><td id="mode3Trans">#if($!transChnlStatTbl.mode3Trans)$!transChnlStatTbl.mode3Trans #else 0 #end</td></tr>
							<tr><td>认证类型4</td><td id="mode4At">#if($!transChnlStatTbl.mode4At)$!transChnlStatTbl.mode4At #else 0 #end</td><td id="mode4Trans">#if($!transChnlStatTbl.mode4Trans)$!transChnlStatTbl.mode4Trans #else 0 #end</td></tr>
							<tr><td>认证类型5</td><td id="mode5At">#if($!transChnlStatTbl.mode5At)$!transChnlStatTbl.mode5At #else 0 #end</td><td id="mode5Trans">#if($!transChnlStatTbl.mode5Trans)$!transChnlStatTbl.mode5Trans #else 0 #end</td></tr>
						</tbody>
					</table>
				</div>
				<div class="col-xs-12">
					<div class="col-xs-6">认证类型1：卡号+姓名</div>
					<div class="col-xs-6">认证类型2：卡号+身份证号</div>
					<div class="col-xs-6">认证类型3：卡号+姓名+身份证号</div>
					<div class="col-xs-6">认证类型4：卡号+姓名+身份证号+手机号</div>
					<div class="col-xs-6">认证类型5： 姓名+身份证号</div>
				</div>
			</div>
		</div>
	</div>
	<div class="col-xs-4">
		<div class="panel panel-red">
			<div class="panel-heading">
				<i class="icon-fire"></i>  最多使用用户
			</div>
			<div class="panel-body" style="padding:0">
				<table class="table table-hover" style="margin:0">
					<thead><th>用户ID</th><th>认证花费</th></thead>
					<tbody>
						#if($!topChnlUserList.size()<=0)
						<tr><td colspan="2">未查询到数据，请重新选择日期</td></tr>
						#end
						#foreach($topChnlUser in $!topChnlUserList)
						<tr><td>$!topChnlUser.userId</td><td>$!topChnlUser.totalAt元</td></tr>
						#end
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>

<script src="${rc.contextPath}/resources/js/bootstrap-datetimepicker.js" type="text/javascript"></script>
<script src="${rc.contextPath}/resources/js/bootstrap-datetimepicker.zh-CN.js" type="text/javascript"></script>
<script src="${rc.contextPath}/resources/js/Chart.min.js" type="text/javascript"></script>
<script>
$('.tmSelect').datetimepicker({
	minView:"month",
	format:"yyyy-mm-dd",
	language:'zh-CN',
	endDate:new Date(),
	autoclose:true
});

function checkDate(){
	var flag = true;
	var startTm = $('#startTime').val();
	var endTm = $('#endTime').val();
	if(""==startTm||""==endTime){
		alert("请选择日期进行查询！");
		flag = false;
	}else{
		if(dateDiff(startTm, endTm).day>31){
			alert("不能大于31天");
			flag = false;
		}
	}
	return flag;
}

$(function(){
	var transChnlStat = ${transChnlStat};
	var barChartData = {
			labels : ["类型1","类型2","类型3","类型4","类型5"],
			datasets : [
				{//交易金额
					fillColor : "rgba(255,102,102,1)",
					strokeColor : "rgba(255,102,102,0.8)",
					highlightFill: "rgba(255,102,102,0.75)",
					highlightStroke: "rgba(255,102,102,1)",
					data : (transChnlStat==null)?[0,0,0,0,0]:[transChnlStat.mode1At,transChnlStat.mode2At,transChnlStat.mode3At,transChnlStat.mode4At,transChnlStat.mode5Trans]
				},
				{//交易笔数
					fillColor : "rgba(0,153,204,1)",
					strokeColor : "rgba(0,153,204,0.8)",
					highlightFill : "rgba(0,153,204,0.75)",
					highlightStroke : "rgba(0,153,204,1)",
					data : (transChnlStat==null)?[0,0,0,0,0]:[transChnlStat.mode1Trans,transChnlStat.mode2Trans,transChnlStat.mode3Trans,transChnlStat.mode4Trans,transChnlStat.mode5Trans]
				}
			]

		}

	var statResultList = ${statResultList};
	var labels = new Array(), dayAtUsed = new Array(), dayTransUsed = new Array();
	var totalAt=0, totalTrans=0;
	for(i=0;i<statResultList.length;i++){
		totalAt =jsAdd(totalAt, statResultList[i].dayAtUsed);
		totalTrans += statResultList[i].dayTransUsed;
		labels[i]=statResultList[i].day;
		dayAtUsed[i]=statResultList[i].dayAtUsed;
		dayTransUsed[i]=statResultList[i].dayTransUsed;
	}
	$('#totalAt').html(totalAt);
	$('#totalTrans').html(totalTrans);
	var lineChartData = {
		labels : labels,
		datasets : [
			{
				label: "每日交易金额",
				fillColor : "rgba(220,220,220,0.2)",
				strokeColor : "#FF6666",
				pointColor : "#FF6666",
				pointStrokeColor : "#fff",
				pointHighlightFill : "#fff",
				pointHighlightStroke : "rgba(220,220,220,1)",
				data : dayAtUsed
			},
			{
				label: "每日交易笔数",
				fillColor : "rgba(149,252,189,0.2)",
				strokeColor : "#0099CC",
				pointColor : "#0099CC",
				pointStrokeColor : "#fff",
				pointHighlightFill : "#fff",
				pointHighlightStroke : "rgba(151,187,205,1)",
				data : dayTransUsed
			}
		]

	}

	window.onload = function(){
		if(statResultList.length>0){
			var ctx = document.getElementById("myChartDayAt").getContext("2d");
			window.myLine = new Chart(ctx).Line(lineChartData, {
				responsive: true
			});
		}
		var ctx = document.getElementById("myBarMode").getContext("2d");
		window.myBar = new Chart(ctx).Bar(barChartData, {
			responsive : true
		});
	}
});

</script>