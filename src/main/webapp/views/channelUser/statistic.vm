<style>
.nav-tabs li a{padding-left:15px}
</style>
<div class="row margin-bottom-20">
	#if($!chnlSysUser.userType!="3")
	<div class="col-xs-12">
		<p>当前位置：<a href="${rc.contextPath}/chnlUser/userList">渠道用户管理</a> >> 用户交易统计信息</p>
		<hr>
	</div>
	#end
	<div class="col-xs-12">
		<h1>$!channelUser.trueName</h1>
		<br>
		<ul id="myTab" class="nav nav-tabs">
			#if($channelUser.userType!="2")
			<li class="active"><a href="${rc.contextPath}/chnlUser/userStatistic?id=$!channelUser.id">交易统计信息</a></li>
			#end
			#if($chnlSysUser.userType=="3")
			<li><a href="${rc.contextPath}/chnlUser/myDetail">基本信息</a></li>
			#else
		    <li><a href="${rc.contextPath}/chnlUser/userDetail?id=$!channelUser.id">基本信息</a></li>
		    #end
		</ul>
	</div>
</div>
#if("2"==$!channelUser.userType)
<div class="row col-xs-12">
	<h3>该用户为管理权限，无交易统计信息</h3>
</div>
#else
<div class="row margin-bottom-20">
	<div class="col-xs-4 text-center">
		<div class="huge">$!channelUser.restAt<span style="font-size:14px;margin-left:7px">元</span></div>
		<div>账户余额</div>
	</div>
	<div class="col-xs-4 text-center">
		<div class="huge">
			$!channelUser.dayAtUsed
			<span style="font-size:14px;margin-left:7px">元/
				#if($!channelUser.dayAtLimit&&""!=$!channelUser.dayAtLimit)$!channelUser.dayAtLimit 元 #else 无上限 #end
			</span>
		</div>
		<div>今日已用额度/每日上限</div>
	</div>
	<div class="col-xs-4 text-center">
		<div class="huge">
			$!channelUser.dayTransUsed
			<span style="font-size:14px;margin-left:7px">笔/
				#if($!channelUser.dayTransLimit&&""!=$!channelUser.dayTransLimit)$!channelUser.dayTransLimit 笔 #else 无上限 #end
			</span>
		</div>
		<div>今日已用笔数/每日上限</div>
	</div>
</div>
<div class="row margin-bottom-20">
	<div class="col-xs-12">
		<form class="form-horizontal" action="${rc.contextPath}/chnlUser/userStatistic">
			<input type="hidden" name="id" value="$!channelUser.id">
			<div class="form-group" style="margin:0;padding:5px;background-color:#BAD2E6">
				<div class="col-xs-2" style="display:inline-block;"></div>
				<label class="col-xs-1 control-label">开始时间</label>
				<div class="col-xs-2">
					<input class="form-control tmSelect" type="text" id="startTime" name="startTime" value="$!startTime">
				</div>
				<label class="col-xs-1 control-label">结束时间</label>
				<div class="col-xs-2">
					<input class="form-control tmSelect" type="text" id="endTime" name="endTime" value="$!endTime">
				</div>
				<div class="col-xs-2">
					<button class="btn btn-primary" onclick="return checkDate()">查询</button>
				</div>
				<div class="col-xs-2" style="display:inline-block"></div>
			</div>
		</form>
	</div>
</div>

<div class="row margin-bottom-20">
	<div class="col-xs-12">
		<div class="panel panel-green">
			<div class="panel-heading">
				<i class="icon-bar-chart"></i>  每日交易量
			</div>
			<div class="panel-body">
				<div class="col-xs-4">时间：$!startTime 至 $!endTime</div>
				<div class="col-xs-4"><span class="statistic-span" style="background-color:#FF6666"></span>交易金额: <span id="totalAt"></span>元</div>
				<div class="col-xs-4"><span class="statistic-span" style="background-color:#0099CC"></span>交易笔数: <span id="totalTrans"></span>笔</div>
				<div class="col-xs-12" style="width:100%;margin:20px auto;">
					#if("$!statResultList"=="[]")
					<h4>未查询到数据，请重新选择日期</h4>
					#else
					<canvas id="myChartDayAt" height="80"></canvas>
					#end
				</div>
			</div>
		</div>
	</div>
</div>
#end

<script src="${rc.contextPath}/resources/js/bootstrap-datetimepicker.js" type="text/javascript"></script>
<script src="${rc.contextPath}/resources/js/bootstrap-datetimepicker.zh-CN.js" type="text/javascript"></script>
<script src="${rc.contextPath}/resources/js/Chart.min.js" type="text/javascript"></script>
<script>
$('.tmSelect').datetimepicker({
	minView:"month",
	format:"yyyy-mm-dd",
	language:'zh-CN',
	endDate:new Date(),
	autoclose:true
});

function checkDate(){
	var flag = true;
	var startTm = $('#startTime').val();
	var endTm = $('#endTime').val();
	if(""==startTm||""==endTime){
		alert("请选择日期进行查询！");
		flag = false;
	}else{
		if(dateDiff(startTm, endTm).day>31){
			alert("不能大于31天");
			flag = false;
		}
	}
	return flag;
}
$(function(){
	var statResultList = ${statResultList};
	var labels = new Array(), dayAtUsed = new Array(), dayTransUsed = new Array();
	var totalAt=0, totalTrans=0;
	for(i=0;i<statResultList.length;i++){
		totalAt = jsAdd(totalAt, statResultList[i].dayAtUsed);
		totalTrans += statResultList[i].dayTransUsed;
		labels[i]=statResultList[i].day;
		dayAtUsed[i]=statResultList[i].dayAtUsed;
		dayTransUsed[i]=statResultList[i].dayTransUsed;
	}
	$('#totalAt').html(totalAt);
	$('#totalTrans').html(totalTrans);
	var lineChartData = {
		labels : labels,
		datasets : [
			{
				label: "每日交易金额",
				fillColor : "rgba(220,220,220,0.2)",
				strokeColor : "#FF6666",
				pointColor : "#FF6666",
				pointStrokeColor : "#fff",
				pointHighlightFill : "#fff",
				pointHighlightStroke : "rgba(220,220,220,1)",
				data : dayAtUsed
			},
			{
				label: "每日交易笔数",
				fillColor : "rgba(149,252,189,0.2)",
				strokeColor : "#0099CC",
				pointColor : "#0099CC",
				pointStrokeColor : "#fff",
				pointHighlightFill : "#fff",
				pointHighlightStroke : "rgba(151,187,205,1)",
				data : dayTransUsed
			}
		]
	
	}
	
	window.onload = function(){
		if(statResultList.length>0){
			var ctx = document.getElementById("myChartDayAt").getContext("2d");
			window.myLine = new Chart(ctx).Line(lineChartData, {
					responsive: true
				});
		}
	}
});
</script>